/*
 jCanvas v13.04.11
 Copyright 2013 Caleb Evans
 Released under the MIT license
*/
(function(d,aa,ga,U,ha,q,C,e,u){function G(){}function L(b){b?D(ia,b):L.prefs=ia=G.prototype=D({},Y);return this}function F(b){return b&&b.getContext?b.getContext("2d"):e}function M(b,a){b.fillStyle=a.fillStyle;b.strokeStyle=a.strokeStyle;b.lineWidth=a.strokeWidth;a.rounded?(b.lineCap="round",b.lineJoin="round"):(b.lineCap=a.strokeCap,b.lineJoin=a.strokeJoin,b.miterLimit=a.miterLimit);b.shadowOffsetX=a.shadowX;b.shadowOffsetY=a.shadowY;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.globalAlpha=
a.opacity;b.globalCompositeOperation=a.compositing;a.imageSmoothing&&(b.webkitimageSmoothingEnabled=b.mozimageSmoothingEnabled=a.imageSmoothing)}function ja(b,a,c){c.mask&&(c.autosave&&(b.save(),a.savedTransforms=D({},a.transforms),a.transforms.masks+=1,a.transforms.withinMask=b.isPointInPath(a.event.x,a.event.y)?q:C),b.clip())}function ba(b,a,c){c.layer&&(c._args.withinMask=a.transforms.withinMask===q||a.transforms.withinMask===e?q:C)}function R(b,a,c){c.closed&&a.closePath();a.fill();"transparent"!==
c.fillStyle&&(a.shadowColor="transparent");0!==c.strokeWidth&&a.stroke();c.closed||a.closePath();c._transformed&&a.restore();if(c.mask||c.layer)b=N(b),ja(a,b,c),ba(a,b,c)}function ka(b,a,c){a._toRad=a.inDegrees?J/180:1;b.translate(a.x,a.y);b.rotate(a.rotate*a._toRad);b.translate(-a.x,-a.y);c.rotate+=a.rotate*a._toRad}function la(b,a,c){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);b.translate(a.x,a.y);b.scale(a.scaleX,a.scaleY);b.translate(-a.x,-a.y);c.scaleX*=a.scaleX;c.scaleY*=a.scaleY}function ma(b,
a,c){a.translate&&(a.translateX=a.translateY=a.translate);b.translate(a.translateX,a.translateY);c.translateX+=a.translateX;c.translateY+=a.translateY}function O(b,a,c,g){a._toRad=a.inDegrees?J/180:1;a._transformed=q;b.save();g===u&&(g=c);!a.fromCenter&&!a._centered&&(a.x+=c/2,a.y+=g/2,a._centered=q);a.rotate&&ka(b,a,{});(1!==a.scale||1!==a.scaleX||1!==a.scaleY)&&la(b,a,{});(a.translate||a.translateX||a.translateY)&&ma(b,a,{})}function N(b){var a;I.canvas===b&&I._data?a=I._data:(a=d.data(b,"jCanvas"),
a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:0,withinMask:e},animating:C,animated:e},a.savedTransforms=D({},a.transforms),d.data(b,"jCanvas",a)),I.canvas=b,I._data=a);return a}function na(b,a,c){c&&c.visible&&(c.method===d.fn.draw?c.fn.call(b[0],a):c.method&&c.method.call(b,c))}function K(b,a,c,g){var h,f={},B,e;a._args=c;a.canvas=b;a.draggable&&(a.layer=q);if(a.layer&&!a._layer){h=d(b);c=h.getLayers();a.method=!a.method&&a.type?
d.fn[oa[a.type]]:d.fn[a.method]||g;e=N(b);f=D(new G,a);for(B in L.events)L.events.hasOwnProperty(B)&&f[B]&&(B=ca(B),L.events[B](h,e),f._event=q);if(f.draggable||f.cursor){f._event=q;b=["mousedown","mousemove","mouseup"];for(a=0;a<b.length;a+=1)B=ca(b[a]),L.events[B](h,e);e.mouseout||(h.bind("mouseout.jCanvas",function(){e.drag={};h.drawLayers()}),e.mouseout=q)}f.layer=q;f._layer=q;f.index===u&&(f.index=c.length);c.splice(f.index,0,f)}return f}function pa(b){var a;for(a=0;a<T.length;a+=1)b[T[a]]=b["_"+
T[a]]}function qa(b,a){var c;for(c=0;c<T.length;c+=1)b["_"+T[c]]=b[T[c]],da[T[c]]=1,a&&delete b[T[c]]}function ra(b){var a,c,g=[],h=1;b.match(/^#?\w+$/i)&&("transparent"===b&&(b="rgba(0,0,0,0)"),c=aa.head,a=c.style.color,c.style.color=b,b=d.css(c,"color"),c.style.color=a);b.match(/^rgb/i)&&(g=b.match(/\d+/gi),b.match(/%/gi)&&(h=2.55),g[0]*=h,g[1]*=h,g[2]*=h,g[3]=g[3]!==u?ha(g[3]):1);return g}function wa(b){var a=3,c;"object"!==typeof b.start&&(b.start=ra(b.start),b.end=ra(b.end));b.now=[];if(1!==
b.start[3]||1!==b.end[3])a=4;for(c=0;c<a;c+=1)b.now[c]=b.start[c]+(b.end[c]-b.start[c])*b.pos,3>c&&(b.now[c]=xa(b.now[c]));1!==b.start[3]||1!==b.end[3]?b.now="rgba("+b.now.join(",")+")":(b.now.slice(0,3),b.now="rgb("+b.now.join(",")+")");b.elem.nodeName?b.elem.style[b.prop]=b.now:b.elem[b.prop]=b.now}function ca(b){"ontouchstart"in window&&ea[b]&&(b=ea[b]);return b}function S(b){L.events[b]=function(a,c){b=ca(b);var g="mouseover"===b||"mouseout"===b?"mousemove":b,h=c.event;c[g]||(a.bind(g+".jCanvas",
function(b){h.x=b.offsetX;h.y=b.offsetY;h.type=g;h.event=b;a.drawLayers({resetFire:q});b.preventDefault()}),c[g]=q)}}function Q(b,a,c){var g,h,f,d;c=c._args;c._event&&(b=N(b),g=b.event,a=a.isPointInPath(g.x,g.y),h=b.transforms,c.eventX=c.mouseX=g.x,c.eventY=c.mouseY=g.y,c.event=g.event,d=b.transforms.rotate,g=c.eventX,f=c.eventY,0!==d?(c._eventX=g*V(-d)-f*W(-d),c._eventY=f*V(-d)+g*W(-d)):(c._eventX=g,c._eventY=f),c._eventX/=h.scaleX,c._eventY/=h.scaleY,!a&&(c._hovered&&!c._fired)&&(c._mousedout=q),
a&&b.intersects.push(c))}function sa(b){"function"===typeof b&&(b={method:d.fn.draw,fn:b});return b}function Z(b,a,c,g,h){a.save();a.beginPath();a.rect(g[0],h[0],g[1]-g[0],h[1]-h[0]);a.clip();O(a,c,0);a.beginPath()}function $(b,a,c){c._event&&Q(b,a,c);a.restore();R(b,a,c)}function ta(b,a){a.font?b.font=a.font:(isNaN(Number(a.fontSize))||(a.fontSize+="px"),b.font=a.fontStyle+" "+a.fontSize+" "+a.fontFamily)}function ua(b,a,c,g,h){var f=/\b(\d*\.?\d*)\w\w\b/gi,e;if(I.text===g.text&&I.font===g.font&&
I.fontStyle===g.fontStyle&&I.fontSize===g.fontSize&&I.fontFamily===g.fontFamily&&I.maxWidth===g.maxWidth&&I.lineHeight===g.lineHeight)g.width=I.width,g.height=I.height;else if(!a){g.width=c.measureText(h[0]).width;for(a=1;a<h.length;a+=1)e=c.measureText(h[a]).width,e>g.width&&(g.width=e);c=b.style.fontSize;if(g.font){if(a=g.font.match(f))b.style.fontSize=g.font.match(f)[0]}else b.style.fontSize=g.fontSize;g.height=ha(d.css(b,"fontSize"))*h.length*g.lineHeight;b.style.fontSize=c}}var Y,ia,D=d.extend,
xa=U.round,J=U.PI,W=U.sin,V=U.cos,ya=d.event.fix,ea,fa,oa,I={},T,da;d.fn.jCanvas=L;L.events={};Y={align:"center",autosave:q,baseline:"middle",bringToFront:C,ccw:C,closed:C,compositing:"source-over",concavity:0,cornerRadius:0,cropFromCenter:q,disableDrag:C,disableEvents:C,domain:e,draggable:C,data:{},each:e,end:360,fillStyle:"transparent",font:"",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:q,fn:e,graph:"y",height:e,imageSmoothing:q,inDegrees:q,lineHeight:1,load:e,mask:C,maxWidth:e,
miterLimit:10,opacity:1,projection:0,r1:e,r2:e,radius:0,range:e,repeat:"repeat",rotate:0,rounded:C,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:e,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:e,sx:e,sy:e,text:"",translate:0,translateX:0,translateY:0,type:e,visible:q,width:e,x:0,y:0};L();L.extend=function(b){L.defaults=D(Y,b.props);L();b.name&&(d.fn[b.name]=function c(g){var h,f,d,e=D(new G,
g);for(f=0;f<this.length;f+=1)if(h=this[f],d=F(h))g=K(h,e,g,c),M(d,e),b.fn.call(h,d,e);return this});return d.fn[b.name]};d.fn.getLayers=function(){var b=this[0];return!b||!b.getContext?[]:N(b).layers};d.fn.getLayer=function(b){var a=this.getLayers(),c=d.type(b),g,h;if(b&&b.layer)g=b;else if("number"===c)0>b&&(b=a.length+b),g=a[b];else for(h=0;h<a.length;h+=1)if(a[h].index=h,a[h].name===b||"regexp"===c&&a[h].name.match(b)){g=a[h];break}return g};d.fn.setLayer=function(b,a){var c,g;for(c=0;c<this.length;c+=
1)d(this[c]),(g=d(this[c]).getLayer(b))&&D(g,a);return this};d.fn.moveLayer=function(b,a){var c,g,h;for(g=0;g<this.length;g+=1)if(c=d(this[g]),h=c.getLayers(),c=c.getLayer(b))h.splice(c.index,1),h.splice(a,0,c),0>a&&(a=h.length+a),c.index=a;return this};d.fn.removeLayer=function(b){var a,c,g;for(c=0;c<this.length;c+=1)a=d(this[c]),g=a.getLayers(),(a=a.getLayer(b))&&g.splice(a.index,1);return this};d.fn.removeLayers=function(){var b,a;for(a=0;a<this.length;a+=1)b=d(this[a]),b=b.getLayers(),b.length=
0;return this};d.fn.getLayerGroup=function(b){var a=this.getLayers(),c=d.type(b),g=[],h;if("array"===c)return b;for(h=0;h<a.length;h+=1)a[h].index=h,(a[h].group===b||"regexp"===c&&a[h].group.match(b))&&g.push(a[h]);return g};d.fn.setLayerGroup=function(b,a){var c,g,h;for(g=0;g<this.length;g+=1){c=d(this[g]);c=c.getLayerGroup(b);for(h=0;h<c.length;h+=1)D(c[h],a)}return this};d.fn.removeLayerGroup=function(b){var a,c,g=d.type(b),h;if(b!==u)for(c=0;c<this.length;c+=1){a=d(this[c]);a=a.getLayers();for(h=
0;h<a.length;h+=1)if(a[h].index=h,a[h].group===b||"regexp"===g&&a[h].group.match(b))a.splice(h,1),h-=1}return this};d.fn.drawLayer=function(b){var a,c,g,h;for(a=0;a<this.length;a+=1)g=d(this[a]),c=F(this[a]),h=g.getLayer(b),na(g,c,h);return this};d.fn.drawLayers=function(b){var a,c,g=b||{},h,f,B,P,v,A;g.index===u&&(g.index=0);for(a=0;a<this.length;a+=1)if(b=d(this[a]),c=F(this[a])){P=N(this[a]);for(f=0;f<P.transforms.masks;f+=1)b.restoreCanvas();g.clear!==C&&b.clearCanvas();h=P.layers;for(B=g.index;B<
h.length&&!(f=h[B],f.index=B,g.resetFire&&(f._fired=C),f._event=!f.disableEvents,na(b,c,f),f._mousedout&&(f._mousedout=C,f._fired=q,f._hovered=C,f.mouseout&&f.mouseout.call(this[a],f),f.cursor&&f._cursor&&b.css({cursor:f._cursor})),f.method===d.fn.drawImage);B+=1);for(f=0;f<P.transforms.masks;f+=1)b.restoreCanvas();f=P.intersects[P.intersects.length-1]||{};c=P.event;B=c.type;f[B]||fa[B]&&(B=fa[B]);A=f[B];v=P.drag;if(f._event&&f.withinMask===q){if((f.mouseover||f.mouseout||f.cursor)&&!f._hovered&&
!f._fired)f._fired=q,f._hovered=q,f.mouseover&&f.mouseover.call(this[a],f),f.cursor&&(f._cursor=b.css("cursor"),b.css({cursor:f.cursor}));A&&!f._fired&&(f._fired=q,A.call(this[a],f),c.type=e);if(f.draggable&&!f.disableDrag&&("mousedown"===B||"touchstart"===B))f.bringToFront&&(h.splice(f.index,1),f.index=h.push(f)),v.layer=f,v.dragging=q,v.startX=f.startX=f.x,v.startY=f.startY=f.y,v.endX=f.endX=f._eventX,v.endY=f.endY=f._eventY,f.dragstart&&f.dragstart.call(this[a],f)}if(v.layer){if(v.dragging&&("mouseup"===
B||"touchend"===B))v.layer.dragstop&&v.layer.dragstop.call(this[a],v.layer),P.drag={};if(v.dragging&&("mousemove"===B||"touchmove"===B))v.layer.x=v.layer._eventX-(v.endX-v.startX),v.layer.y=v.layer._eventY-(v.endY-v.startY),v.layer.drag&&v.layer.drag.call(this[a],v.layer)}P.intersects=[]}return this};d.fn.addLayer=function(b){var a,c,g;b=sa(b);g=D(new G,b);for(a=0;a<this.length;a+=1)if(c=F(this[a]))g.layer=q,b=K(this[a],g,b);return this};T=["width","height","opacity","lineHeight"];da={};d.fn.animateLayer=
function(){function b(a,b,c){return function(){pa(c);(!b.animating||b.animated===c)&&a.drawLayers();f[4]&&f[4].call(a[0],c);c._animating=C;b.animating=C;b.animated=e}}function a(a,b,c){return function(g,h){pa(c);!c._animating&&!b.animating&&(c._animating=q,b.animating=q,b.animated=c);(!b.animating||b.animated===c)&&a.drawLayers();f[5]&&f[5].call(a[0],g,h,c)}}var c,g,h,f=[].slice.call(arguments,0),B;"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);"object"===typeof f[2]?(f.splice(2,0,f[2].duration||
e),f.splice(3,0,f[3].easing||e),f.splice(4,0,f[4].complete||e),f.splice(5,0,f[5].step||e)):(f[2]===u?(f.splice(2,0,e),f.splice(3,0,e),f.splice(4,0,e)):"function"===typeof f[2]&&(f.splice(2,0,e),f.splice(3,0,e)),f[3]===u?(f[3]=e,f.splice(4,0,e)):"function"===typeof f[3]&&f.splice(3,0,e));f[1]=D({},f[1]);qa(f[1],q);for(g=0;g<this.length;g+=1)if(c=d(this[g]),h=F(this[g]))if(h=N(this[g]),(B=c.getLayer(f[0]))&&B.method!==d.fn.draw)qa(B),B.style=da,d(B).animate(f[1],{duration:f[2],easing:d.easing[f[3]]?
f[3]:e,complete:b(c,h,B),step:a(c,h,B)});return this};d.fn.animateLayerGroup=function(b){var a,c,g=[].slice.call(arguments,0),h,f;for(c=0;c<this.length;c+=1){a=d(this[c]);h=a.getLayerGroup(b);for(f=0;f<h.length;f+=1)a.animateLayer.apply(a,[h[f]].concat(g.slice(1)))}};d.fn.delayLayer=function(b,a){var c,g;a=a||0;for(c=0;c<this.length;c+=1)g=d(this[c]).getLayer(b),d(g).delay(a);return this};d.fn.delayLayerGroup=function(b,a){var c,g,h,f;a=a||0;for(g=0;g<this.length;g+=1){c=d(this[g]);h=c.getLayerGroup(b);
for(f=0;f<h.length;f+=1)c.delayLayer.call(c,h[f],a)}};d.fn.stopLayer=function(b,a){var c,g;for(c=0;c<this.length;c+=1)g=d(this[c]).getLayer(b),d(g).stop(a);return this};d.fn.stopLayerGroup=function(b,a){var c,g,h,f;for(g=0;g<this.length;g+=1){c=d(this[g]);h=c.getLayerGroup(b);for(f=0;f<h.length;f+=1)c.stopLayer.call(c,h[f],a)}};var va="color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "),X;for(X=
0;X<va.length;X+=1)d.fx.step[va[X]]=wa;ea={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};fa={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};S("click");S("dblclick");S("mousedown");S("mouseup");S("mousemove");S("mouseover");S("mouseout");S("touchstart");S("touchmove");S("touchend");d.event.fix=function(b){var a,c;b=ya.call(d.event,b);if(a=b.originalEvent)if(c=a.changedTouches,b.pageX!==u&&b.offsetX===u){if(a=d(b.target).offset())b.offsetX=b.pageX-a.left,b.offsetY=
b.pageY-a.top}else if(c&&(a=d(a.target).offset()))b.offsetX=c[0].pageX-a.left,b.offsetY=c[0].pageY-a.top;return b};oa={arc:"drawArc",bezier:"drawBezier",circle:"drawArc",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector"};d.fn.draw=function a(c){var g,h,f;c=sa(c);f=D(new G,c);for(g=0;g<this.length;g+=1)if((h=F(this[g]))&&f.fn)c=K(this[g],f,c,a),f.visible&&f.fn.call(this[g],
h);return this};d.fn.clearCanvas=function(a){var c,g=D(new G,a);for(a=0;a<this.length;a+=1)if(c=F(this[a]))c.setTransform(1,0,0,1,0,0),!g.x||!g.y||!g.width||!g.height?c.clearRect(0,0,this[a].width,this[a].height):c.clearRect(g.x-g.width/2,g.y-g.height/2,g.width,g.height),c.restore();return this};d.fn.saveCanvas=function(){var a,c,g;for(a=0;a<this.length;a+=1)if(c=F(this[a]))g=N(this[a]),c.save(),g.savedTransforms=D({},g.transforms);return this};d.fn.restoreCanvas=function(){var a,c,g;for(a=0;a<this.length;a+=
1)if(c=F(this[a]))g=N(this[a]),c.restore(),g.transforms=D({},g.savedTransforms);return this};d.fn.restoreCanvasOnRedraw=function(a){var c={layer:q,fn:function(){d(this).restoreCanvas()}};D(c,a);return this.draw(c)};d.fn.translateCanvas=function c(g){var h,f,d=D(new G,g),e;for(h=0;h<this.length;h+=1)if(f=F(this[h]))e=N(this[h]),g=K(this[h],d,g,c),d.autosave&&f.save(),ma(f,d,e.transforms);return this};d.fn.scaleCanvas=function g(h){var f,d,e=D(new G,h),v;for(f=0;f<this.length;f+=1)if(d=F(this[f]))v=
N(this[f]),h=K(this[f],e,h,g),e.autosave&&d.save(),la(d,e,v.transforms);return this};d.fn.rotateCanvas=function h(f){var d,e,v=D(new G,f),A;for(d=0;d<this.length;d+=1)if(e=F(this[d]))A=N(this[d]),f=K(this[d],v,f,h),v.autosave&&e.save(),ka(e,v,A.transforms);return this};d.fn.drawRect=function f(d){var e,v,A=D(new G,d),y,x,w,z,s;for(e=0;e<this.length;e+=1)if(v=F(this[e]))d=K(this[e],A,d,f),A.visible&&(M(v,A),O(v,A,A.width,A.height),v.beginPath(),y=A.x-A.width/2,x=A.y-A.height/2,(s=A.cornerRadius)?(A.closed=
q,w=A.x+A.width/2,z=A.y+A.height/2,0>w-y-2*s&&(s=(w-y)/2),0>z-x-2*s&&(s=(z-x)/2),v.moveTo(y+s,x),v.lineTo(w-s,x),v.arc(w-s,x+s,s,3*J/2,2*J,C),v.lineTo(w,z-s),v.arc(w-s,z-s,s,0,J/2,C),v.lineTo(y+s,z),v.arc(y+s,z-s,s,J/2,J,C),v.lineTo(y,x+s),v.arc(y+s,x+s,s,J,3*J/2,C)):v.rect(y,x,A.width,A.height),A._event&&Q(this[e],v,A),R(this[e],v,A));return this};d.fn.drawArc=function B(d){var e,A,y=D(new G,d);d=d||{};y.layer&&(!y.inDegrees&&360===y.end)&&(d.end=y.end=2*J);for(e=0;e<this.length;e+=1)if(A=F(this[e]))d=
K(this[e],y,d,B),y.visible&&(M(A,y),O(A,y,2*y.radius),A.beginPath(),A.arc(y.x,y.y,y.radius,y.start*y._toRad-J/2,y.end*y._toRad-J/2,y.ccw),y._event&&Q(this[e],A,y),R(this[e],A,y));return this};d.fn.drawEllipse=function P(d){var e,y,x=D(new G,d),w=4*x.width/3,z=x.height;x.closed=q;for(e=0;e<this.length;e+=1)if(y=F(this[e]))d=K(this[e],x,d,P),x.visible&&(M(y,x),O(y,x,x.width,x.height),y.beginPath(),y.moveTo(x.x,x.y-z/2),y.bezierCurveTo(x.x-w/2,x.y-z/2,x.x-w/2,x.y+z/2,x.x,x.y+z/2),y.bezierCurveTo(x.x+
w/2,x.y+z/2,x.x+w/2,x.y-z/2,x.x,x.y-z/2),x._event&&Q(this[e],y,x),R(this[e],y,x));return this};d.fn.drawPolygon=function v(d){var e,x,w=D(new G,d),z=2*J/w.sides,s=J/w.sides,p=s+J/2,n=w.radius*V(z/2),k,m,r;w.closed=q;w.projection&&(w.concavity=-w.projection);for(e=0;e<this.length;e+=1)if(x=F(this[e]))if(d=K(this[e],w,d,v),w.visible){M(x,w);O(x,w,2*w.radius);x.beginPath();for(r=0;r<w.sides;r+=1)k=w.x+w.radius*V(p),m=w.y+w.radius*W(p),x.lineTo(k,m),w.concavity&&(k=w.x+(n+-n*w.concavity)*V(p+s),m=w.y+
(n+-n*w.concavity)*W(p+s),x.lineTo(k,m)),p+=z;w._event&&Q(this[e],x,w);R(this[e],x,w)}return this};d.fn.drawLine=function A(d){var e,w,z=D(new G,d),s,p,n;for(e=0;e<this.length;e+=1)if(w=F(this[e]))if(d=K(this[e],z,d,A),z.visible){M(w,z);O(w,z,0);s=1;for(w.beginPath();q;)if(p=z["x"+s],n=z["y"+s],p!==u&&n!==u)w.lineTo(p+z.x,n+z.y),s+=1;else break;z._event&&Q(this[e],w,z);R(this[e],w,z)}return this};d.fn.drawQuadratic=d.fn.drawQuad=function y(d){var e,z,s=D(new G,d),p,n,k,m,r;for(e=0;e<this.length;e+=
1)if(z=F(this[e]))if(d=K(this[e],s,d,y),s.visible){M(z,s);O(z,s,0);p=2;z.beginPath();for(z.moveTo(s.x1+s.x,s.y1+s.y);q;)if(n=s["x"+p],k=s["y"+p],m=s["cx"+(p-1)],r=s["cy"+(p-1)],n!==u&&k!==u&&m!==u&&r!==u)z.quadraticCurveTo(m+s.x,r+s.y,n+s.x,k+s.y),p+=1;else break;s._event&&Q(this[e],z,s);R(this[e],z,s)}return this};d.fn.drawBezier=function x(d){var e,s,p=D(new G,d),n,k,m,r,t,l,E,j;for(e=0;e<this.length;e+=1)if(s=F(this[e]))if(d=K(this[e],p,d,x),p.visible){M(s,p);O(s,p,0);n=2;k=1;s.beginPath();for(s.moveTo(p.x1+
p.x,p.y1+p.y);q;)if(m=p["x"+n],r=p["y"+n],t=p["cx"+k],l=p["cy"+k],E=p["cx"+(k+1)],j=p["cy"+(k+1)],m!==u&&r!==u&&t!==u&&l!==u&&E!==u&&j!==u)s.bezierCurveTo(t+p.x,l+p.y,E+p.x,j+p.y,m+p.x,r+p.y),n+=1,k+=2;else break;p._event&&Q(this[e],s,p);R(this[e],s,p)}return this};d.fn.drawVector=function w(e){var d,p,n=D(new G,e),k,m,r,t,l;for(d=0;d<this.length;d+=1)if(p=F(this[d]))if(e=K(this[d],n,e,w),n.visible){M(p,n);O(p,n,0);k=1;p.beginPath();t=n.x;l=n.y;for(p.moveTo(n.x,n.y);q;)if(m=n["a"+k],r=n["l"+k],m!==
u&&r!==u)m=m*n._toRad-J/2,t+=r*U.cos(m),l+=r*U.sin(m),p.lineTo(t,l),k+=1;else break;n._event&&Q(this[d],p,n);R(this[d],p,n)}return this};d.fn.drawGraph=function z(d){var p,n,k=D(new G,d),m,r,t,l,E,j;for(p=0;p<this.length;p+=1)if((n=F(this[p]))&&k.fn)if(d=K(this[p],k,d,z),k.visible){M(n,k);m=k.graph;r=k.domain;t=k.range;l=this[p].width;E=this[p].height;r===e&&(r=[e,e]);r[0]===e&&(r[0]=0);r[1]===e&&(r[1]=l);t===e&&(t=[e,e]);t[0]===e&&(t[0]=0);t[1]===e&&(t[1]=E);Z(p,n,k,r,t);if("y"===m)for(m=r[0]-k.x;m<=
r[1]-k.x;m+=1)l=k.fn(m,k),l===e?($(this[p],n,k),Z(p,n,k,r,t)):n.lineTo(m+k.x,l+k.y);else if("x"===m)for(l=t[0]-k.y;l<=t[1]-k.y;l+=1)m=k.fn(l,k),m===e?($(this[p],n,k),Z(p,n,k,r,t)):n.lineTo(m+k.x,l+k.y);else if("r"===m)for(j=0;j<2*J;j+=J/180)E=k.fn(j,k),m=E*V(j),l=E*W(j),E===e?($(this[p],n,k),Z(n,k,r,t)):n.lineTo(m+k.x,l+k.y);$(this[p],n,k)}};d.fn.drawText=function s(p){var n,k,m=D(new G,p),r,t,l,E;for(n=0;n<this.length;n+=1)if(d(this[n]),k=F(this[n]))if(p=K(this[n],m,p,s),m.visible){M(k,m);k.textBaseline=
m.baseline;k.textAlign=m.align;ta(k,m);if(!n&&m.maxWidth!==e){r=k;t=m.text;E=m.maxWidth;var j=t.split(" "),H=void 0,q=[],u="";if(r.measureText(t).width<E||1===j.length)q=[t];else{for(H=0;H<j.length;H+=1)r.measureText(u+j[H]).width>E&&(""!==u&&q.push(u),u=""),u+=j[H],H!==j.length-1&&(u+=" ");q.push(u)}r=q;r=r.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else n||(r=String(m.text).split("\n"));ua(this[n],n,k,m,r);O(k,m,m.width,m.height);n||(l=m.x,"left"===m.align?l-=m.width/2:"right"===m.align&&
(l+=m.width/2));for(t=0;t<r.length;t+=1)k.shadowColor=m.shadowColor,E=m.y+t*m.height/r.length-(r.length-1)*m.height/r.length/2,k.fillText(r[t],l,E),"transparent"!==m.fillStyle&&(k.shadowColor="transparent"),k.strokeText(r[t],l,E);m._event?(k.beginPath(),k.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),k.restore(),Q(this[n],k,m),k.closePath(),ba(k,N(this[n]),m)):k.restore()}I=m;return this};d.fn.measureText=function(d){var e;e=d!==u&&("object"!==typeof d||d.layer)?this.getLayer(d):D(new G,d);
if((d=F(this[0]))&&e.text!==u)ta(d,e),ua(this[0],0,d,e,e.text.split("\n"));return e};d.fn.drawImage=function p(n){function k(p,k,l){return function(){0===k&&(j.width===e&&j.sWidth===e&&(j.width=j.sWidth=q.width),j.height===e&&j.sHeight===e&&(j.height=j.sHeight=q.height),n&&j.layer&&(n.width=j.width,n.height=j.height),j.sWidth!==e&&j.sHeight!==e&&j.sx!==e&&j.sy!==e?(j.width===e&&(j.width=j.sWidth),j.height===e&&(j.height=j.sHeight),j.cropFromCenter||(j.sx+=j.sWidth/2,j.sy+=j.sHeight/2),j.sx+j.sWidth/
2>q.width&&(j.sx=q.width-j.sWidth/2),0>j.sx-j.sWidth/2&&(j.sx=j.sWidth/2),0>j.sy-j.sHeight/2&&(j.sy=j.sHeight/2),j.sy+j.sHeight/2>q.height&&(j.sy=q.height-j.sHeight/2),M(l,j),O(l,j,j.width,j.height),l.drawImage(q,j.sx-j.sWidth/2,j.sy-j.sHeight/2,j.sWidth,j.sHeight,j.x-j.width/2,j.y-j.height/2,j.width,j.height)):(M(l,j),O(l,j,j.width,j.height),l.drawImage(q,j.x-j.width/2,j.y-j.height/2,j.width,j.height)));l.beginPath();l.rect(j.x-j.width/2,j.y-j.height/2,j.width,j.height);j._event&&Q(m[k],l,j);j._transformed&&
l.restore();E=N(m[k]);l.closePath();ja(l,E,j);ba(l,E,j);j.load&&j.load.call(p,n);j.layer&&d(p).drawLayers({clear:C,index:j.index+1})}}var m=this,r,t,l,E,j=D(new G,n),q,u;r=j.source;u=r.getContext;r.src||u?q=r:r&&(I.source===r?q=I._source:(q=new ga,q.src=r,I.source=r,I._source=q));for(t=0;t<m.length;t+=1)if(r=m[t],l=F(m[t]))n=K(m[t],j,n,p),j.visible&&q&&(q.complete||u?k(r,t,l)():(d(q).bind("load",k(r,t,l)),q.src=q.src));return m};d.fn.createPattern=d.fn.pattern=function(p){function n(){l=m.createPattern(t,
r.repeat);r.load&&r.load.call(k[0],l)}var k=this,m,r=D(new G,p),t,l,q;(m=F(k[0]))?(q=r.source,"function"===typeof q?(t=aa.createElement("canvas"),t.width=r.width,t.height=r.height,p=F(t),q.call(t,p),n()):(p=q.getContext,q.src||p?t=q:(t=new ga,t.src=q),t.complete||p?n():(d(t).bind("load",n),t.src=t.src))):l=e;return l};d.fn.createGradient=d.fn.gradient=function(d){var n;d=D(new G,d);var k=[],m,r,q,l,E,j,H;if(n=F(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;n=d.r1!==e||d.r2!==e?n.createRadialGradient(d.x1,
d.y1,d.r1,d.x2,d.y2,d.r2):n.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(l=1;d["c"+l]!==u;l+=1)d["s"+l]!==u?k.push(d["s"+l]):k.push(e);m=k.length;k[0]===e&&(k[0]=0);k[m-1]===e&&(k[m-1]=1);for(l=0;l<m;l+=1){if(k[l]!==e){j=1;H=0;r=k[l];for(E=l+1;E<m;E+=1)if(k[E]!==e){q=k[E];break}else j+=1;r>q&&(k[E]=k[l])}else k[l]===e&&(H+=1,k[l]=r+H*((q-r)/j));n.addColorStop(k[l],d["c"+(l+1)])}}else n=e;return n};d.fn.setPixels=function n(d){var e,r,q,l=D(new G,d),u={},j,H,C,I;for(r=0;r<this.length;r+=1)if(e=this[r],
q=F(e)){d=K(e,l,d,n);O(q,l,l.width,l.height);if(null===l.width||null===l.height)l.width=e.width,l.height=e.height,l.x=l.width/2,l.y=l.height/2;if(0!==l.width&&0!==l.height){j=q.getImageData(l.x-l.width/2,l.y-l.height/2,l.width,l.height);H=j.data;I=H.length;u=[];if(l.each)for(C=0;C<I;C+=4)u.r=H[C],u.g=H[C+1],u.b=H[C+2],u.a=H[C+3],l.each.call(e,u),H[C]=u.r,H[C+1]=u.g,H[C+2]=u.b,H[C+3]=u.a;q.putImageData(j,l.x-l.width/2,l.y-l.height/2);q.restore()}}return this};d.fn.getCanvasImage=function(d,k){var m=
this[0];k===u&&(k=1);return m&&m.toDataURL?m.toDataURL("image/"+d,k):e};d.support.canvas=aa.createElement("canvas").getContext!==u;L.defaults=Y;L.detectEvents=Q;L.closePath=R;d.jCanvas=L})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
